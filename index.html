<html>
<head>
</head>
<body>

<button onclick="simulateCombat">Simulate</button>

<div id="simulationResult"></div>
</body>
</html>

<script>

function simulateCombat(playerStats) {
    var playerStats = [];
    playerStats.push(500);
    playerStats.push(500);
    playerStats.push(500);
    playerStats.push(500);
    playerStats.push(500);
    playerStats.push(500);
    playerStats.push(500);
    playerStats.push(500);
    playerStats.push(500);
    var beatableEnemyStats = null;
    var statsToCheck = Math.round((playerStats[2] + playerStats[3] + playerStats[4] + playerStats[5]) / 4) * 1.3;
    var highestWin = 0;
    var attempts = 0;
    var simulations = 100;
    while (beatableEnemyStats == null && attempts < 100) {
        var deaths = 0;
        var playerWins = null;
        var player = new Object();
        player.damage = playerStats[0] + playerStats[2];
        player.health = playerStats[3] * 50;
        player.maxHealth = player.health;
        player.healing = player.health * 0.025;
        player.hit = Math.round(playerStats[5]/(playerStats[5]+statsToCheck) * 10000);
        var mob = new Object();
        mob.damage = statsToCheck - playerStats[1];
        mob.health = statsToCheck * 50;
        mob.hit = 10000 - player.hit;
        if (mob.damage <= 0) {
            playerWins = true;
        } else if (player.damage <= 0) {
            playerWins = false;
        }
        if (playerWins == null) {
            for (var i = 0; i < simulations; i++) {
                var fight = new Object();
                fight.player = Object.create(player);
                fight.mob = Object.create(mob);
                while (fight.player.health > 0 && fight.mob.health > 0) {
                    var hits = 1 + getHits(playerStats[8]);
                    for (var j = 0; j < hits; j++) {
                        if (getRandom(1, 10000) <= player.hit) {
                            fight.mob.health -= getDamage(player.damage, playerStats[6], playerStats[7]);
                        }
                    }
                    if (fight.mob.health > 0 && getRandom(1, 10000) <= mob.hit) {
                        fight.player.health -= mob.damage;
                    }
                    var heals = getHits(playerStats[9]);
                    for (j = 0; j < heals; j++) {
                        fight.player.health += Math.round(fight.player.healing);
                        fight.player.healing *= 0.99;
                        if (fight.player.health > fight.player.maxHealth) {
                            fight.player.health = fight.player.maxHealth;
                        }
                    }
                }
                if (fight.player.health <= 0) {
                    deaths++;
                    if (deaths >= 2) {
                        playerWins = false;
                        break;
                    }
                }
            }
        }
        if (playerWins == null || playerWins) {
            highestWin = statsToCheck;
            statsToCheck *= 1.04;
        } else {
            statsToCheck *= 0.99;
            simulations = 1000;
            if (statsToCheck <= highestWin) {
                beatableEnemyStats = highestWin;
            }
        }
        attempts++;
    }
    document.getElementById("simulationResult").textContent = beatableEnemyStats;
}
</script>
